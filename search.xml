<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[关于坐标系的那些事儿]]></title>
    <url>%2F2017%2F06%2F07%2Fcoordinate-system%2F</url>
    <content type="text"><![CDATA[在做一个涉及GIS应用的项目，由于不能使用第三方引擎，故而只能自己实现对sharpfile的解析与渲染。借此机会，正好系统性的梳理了一下关于坐标系的一些基础概念，收集与整理了网络上的各类资料，以备后用。 大地坐标系大地坐标系是一种固定在地球上，随地球一起转动的非惯性坐标系。大地坐标系根据其原点的位置不同，分为地心坐标系和参心坐标系。地心坐标系的原点与地球质心重合，参心坐标系的原点与某一地区或国家所采用的参考椭球中心重合，通常与地球质心不重合。我国先后建立的1954年北京坐标系、1980西安坐标系和新1954年北京坐标系，都是参心坐标系。 大地坐标系是大地测量中以参考椭球面为基准面建立起来的坐标系。地面任意点的位置用大地经度、大地纬度和大地高度表示。大地坐标系是曲面上的坐标系，因此要以一定的投影方式将其投影为平面xy坐标系，再建立一个高程系统就可以以平面形式表示任意点位置及高程。 WGS84WGS-84坐标系的几何意义是：坐标系的原点位于地球质心，z轴指向（国际时间局）BIH1984.0定义的协议地球极(CTP)方向，x轴指向BIH1984.0的零度子午面和CTP赤道的交点，y轴通过右手规则确定。 长轴：6378137.000m 短轴：6356752.314 扁率：1/298.257223563 第一偏心率：0.081819790992 第二偏心率：0.082095040121 WGS84是面向全球的，所以它尽量逼近整个地球表面，优点是范围大，缺点是局部不够精确。GPS用的是WGS84，所以我们手机看到的是WGS84坐标系的经纬度。ß 北京54北京54的参考椭圆采用克拉索夫斯基(1940)椭球。由于用的是前苏联的参数，它是面向苏联的，所以它在前苏联区域这个曲面尽量逼近，而其它国家地区偏多少它不管。它以苏联的普尔科沃为中心，离那越远，误差就越大。 长轴6378245m 短轴6356863 扁率1/298.2997381 西安80西安80的参考椭圆采用1975国际椭球（1975年国际大地测量与地球物理联合会第十六届大会推荐的数据），该坐标系的大地原点设在我国中部的陕西省泾阳县永乐镇，位于西安市西北方向约60公里，故称1980年西安坐标系，又简称西安大地原点。基准面采用青岛大港验潮站1952－1979年确定的黄海平均海水面（即1985国家高程基准）。 长轴6378140m 短轴6356755 扁率1/298.25722101 西安80是面向中国的，所以它在中国区域这个曲面尽量逼近，而其它国家地区偏多少它不管。而且这个逼近是以西安附近的大地原点为中心的，也就是说，在西安大地原点处，模型和真实地表参考海平面重合，误差为0，而离大地原点越远的地方，误差越大。所谓的大地原点就是这么来的，它是人为去定的，而不是必须在那里，它要尽量放在中国的中间，使得总的误差尽量小而分布均匀。然后，我国在自已境内进行的建筑，测绘，勘探什么的所绘制的图，都以这个大地原点为基准，去建立各种用途的地表坐标系，就能统一起来了。 转换WGS-84地心坐标系可以与1954北京坐标系或1980西安坐标系等参心坐标系相互转换，其方法之一是：在测区内，利用至少3个以上公共点的两套坐标列出坐标转换方程，采用最小二乘原理解算出7个转换参数就可以得到转换方程。其中7个转换参数是指3个平移参数、3个旋转参数和1个尺度参数。 地图在平面上的投影高斯-克吕格投影西安80与北京54平面坐标都是以高斯-克吕格投影所得。 高斯克吕格投影的变形分析： 中央经线上无变形，满足投影后长度比不变的条件； 除中央经线上长度比为1以外，其它任何点长度比均大于1； 在同一条纬线上，离中央经线越远则变形越大，最大值位于投影带边缘。 在同一条经线上，纬度越低变形越大，最大值位于赤道上。 等角投影，无角度变形，面积比为长度比的平方。 长度比的等变形线平行于中央轴子午线。 优点：长度和面积变形是最小的(比起其它投影)。缺点：需要分带，相邻的带不能拼接(上尖下宽怎么接？好难个)，导致覆盖范围小。 所以高斯投影适用于小地区的地图，一个带就能覆盖的地区。 UTMUTM投影全称为”通用横轴墨卡托投影”，UNIVERSAL TRANSVERSE MERCATOR PROJECTION，是一种“等角横轴割圆柱投影”，椭圆柱割地球于南纬80度、北纬84度两条等高圈，投影后两条相割的经线上没有变形，而中央经线上长度比0.9996。UTM投影是为了全球战争需要创建的，美国于1948年完成这种通用投影系统的计算。与高斯-克吕格投影相似，该投影角度没有变形，中央经线为直线，且为投影的对称轴，中央经线的比例因子取0.9996是为了保证离中央经线左右约180km处有两条不失真的标准经线。 UTM投影分带方法与高斯-克吕格投影相似，将北纬84度至南纬80度之间按经度分为60个带,每带6度.从西经180度起算,两条标准经线距中央经线为180KM左右,中央经线比例系数为0.9996. 假设地球被围在一中空的圆柱里，其基准纬线与圆柱相切（赤道）接触，然后再假想地球中心有一盏灯，把球面上的图形投影到圆柱体上，再把圆柱体展开，这就是一幅选定基准纬线上的“墨卡托投影”绘制出的地图。 优点：没有角度变形，由每一点向各方向的长度比相等，它的经纬线都是平行直线，且相交成直角。缺点：长度和面积变形明显，纬线间隔从基准纬线处向两极逐渐增大。但因为它具有各个方向均等扩大的特性，保持了方向和相互位置关系的正确。 墨卡托投影地图常用作航海图和航空图，如果循着墨卡托投影图上两点间的直线航行，方向不变可以一直到达目的地，因此它对船舰在航行中定位、确定航向都具有有利条件，给航海者带来很大方便。 谷歌地图，百度地图用的就是墨卡托投影，且以赤道作基准纬线。 高斯-克吕格投影与UTM投影转化某些国外的软件如ARC/INFO或国外仪器的配套软件如多波束的数据处理软件等，往往不支持高斯-克吕格投影，但支持UTM投影，因此常有把UTM投影坐标当作高斯-克吕格投影坐标提交的现象。 UTM投影与高斯投影的主要区别在南北格网线的比例系数上，高斯-克吕格投影的中央经线投影后保持长度不变，即比例系数为1，而UTM投影的比例系数为0.9996。UTM投影沿每一条南北格网线比例系数为常数，在东西方向则为变数，中心格网线的比例系数为0.9996，在南北纵行最宽部分的边缘上距离中心点大约 363公里，比例系数为 1.00158。 高斯-克吕格投影与UTM投影可近似采用 Xutm=0.9996 X高斯，Yutm=0.9996 Y高斯进行坐标转换。以下举例说明(基准面为WGS84)： 输入坐标（度） 高斯投影（米） UTM投影（米） Xutm=0.9996 X高斯 , Yutm=0.9996 Y高斯 纬度值（X）32 3543600.9 3542183.5 3543600.9*0.9996 ≈ 3542183.5 经度值（Y）121 21310996.8 311072.4 (310996.8-500000)*0.9996+500000 ≈ 311072.4 注：坐标点（32,121）位于高斯投影的21带，高斯投影Y值21310996.8中前两位“21”为带号；坐标点（32,121）位于UTM投影的51带，上表中UTM投影的Y值没加带号。因坐标纵轴西移了500000米，转换时必须将Y值减去500000乘上比例因子后再加500000。 单点转换步骤如下（1）选择是高斯正转换还是反转换，缺省为经纬度转换到高斯投影坐标，投影坐标单位为米。（2）选择大地基准面，缺省北京54，如果是GPS定位数据别忘了切换为WGS84。（3）选择分带，3度或6度， 缺省为6度。（4）输入中央经度，20带（114°E～120°E）中央经度为117度，21带（120°E～126°E）中央经度为123度。（5）如正向投影，选择经纬度输入数据格式，有三个选项，缺省为十进制度格式。具体输入方式如下例： 格式 原始纬度值 原始经度值 输入纬度值 输入经度值 十进制度 35.445901° 122.997344° 35.445901 122.997344 度分 35°26.7541′ 122°59.8406′ 3526.7541 12259.8406 度分秒 35°26′45.245″ 122°59′50.438″ 352645.245 1225950.438 （6）正投影按选定格式在“输入”栏输入经纬度值，反投影输入以米为单位的X、Y坐标值。（7）单击“单点转换”按钮。（8）在“输出”栏查看计算结果。 批量转换步骤（1）准备好需要转换的输入数据文件，要求是文本文件，分两列，第一列纬度值或纵向坐标值，第二列经度值或横向坐标值，两列之间用空格分开。正向投影时，纬度值及经度值格式可以有三种选择，缺省当作十进制度处理；反向投影时，纵向及横向坐标值必须以米为单位。下例为度分秒格式(WGS84)的6°带正投影输入数据文件 testdata.txt 352645.245 1225950.438 353800.402 1230000.378 351600.519 1225959.506 345800.101 1225959.8 343600.336 1230000.26 341400.018 1225959.897 335159.17 1225959.46 333000.08 1230000.28 （2）选择是高斯正转换还是反转换，缺省为经纬度转换到高斯投影坐标，投影坐标单位为米。（3）选择大地基准面，缺省北京54，如果是GPS定位数据别忘了切换为WGS84。（4）选择分带，3度或6度， 缺省为6度。（5）输入中央经度，20带（114°E～120°E）中央经度为117度,21带（120°E～126°E）中央经度为123度。（6）如正向投影，选择输入数据文件中的经纬度输入数据格式，有三个选项，缺省为十进制度格式。（7）单击“批量转换”按钮。弹出打开文件对话框，输入你的数据文件名。（8）输入转换结果文件名，单击“保存”后，程序开始进行计算。（9）打开输出文件查看计算结果，结果分五列，第一序号,第二列输入纬度值或纵向坐标值，第三列输入经度值或横向坐标值,第四列转换后纬度值或纵向坐标值，第五列转换后经度值或横向坐标值。下例为度分秒格式(WGS84)的6°带正投影转换结果数据文件 result.txt 1 352645.245 1225950.438 3924063.3 21499758.9 2 353800.402 1230000.378 3944871.4 21500009.5 3 351600.519 1225959.506 3904193.8 21499987.5 4 345800.101 1225959.8 3870898.1 21499994.9 5 343600.336 1230000.26 3830228.5 21500006.6 6 341400.018 1225959.897 3789544.4 21499997.4 7 335159.17 1225959.46 3748846.4 21499986.1 8 333000.08 1230000.28 3708205 21500007.2 常用工具在线坐标转换：http://www.earthpoint.us/Convert.aspx 中国分区中国共分五个时区： 中原时区：以东经120度为中央子午线。 陇蜀时区：以东经105度为中央子午线。 新藏时区：以东经90度为中央子午线。 昆仑时区：以东经75(82.5)度为中央子午线。 长白时区：以东经135(127.5)度为中央子午线。 分带方法我国采用6度分带和3度分带： 1∶2.5万及1∶5万的地形图采用6度分带投影，即经差为6度，从零度子午线开始，自西向东每个经差6度为一投影带，全球共分60个带，用1，2，3，4，5，……表示．即东经0～6度为第一带，其中央经线的经度为东经3度，东经6～12度为第二带，其中央经线的经度为9度。 1∶1万的地形图采用3度分带，从东经1.5度的经线开始，每隔3度为一带，用1，2，3，……表示，全球共划分120个投影带，即东经1.5～ 4.5度为第1带，其中央经线的经度为东经3度，东经4.5～7.5度为第2带，其中央经线的经度为东经6度．我省位于东经113度－东经120度之间，跨第38、39、40共计3个带，其中东经115.5度以西为第38带，其中央经线为东经114度；东经115.5～118.5度为39带，其中央经线为东经117度；东经118.5度以东到山海关为40带，其中央经线为东经120度。地形图上公里网横坐标前2位就是带号，例如：1∶5万地形图上的横坐标为20345486，其中20即为带号，345486为横坐标值。2．当地中央经线经度的计算六度带中央经线经度的计算：当地中央经线经度＝６°×当地带号－３°，例如：地形图上的横坐标为２０３４５，其所处的六度带的中央经线经度为：６°×２０－３°＝１１７°（适用于１∶２．５万和１∶５万地形图）。三度带中央经线经度的计算：中央经线经度＝３°×当地带号（适用于１∶１万地形图）。]]></content>
      <categories>
        <category>基础技术</category>
      </categories>
      <tags>
        <tag>WGS84</tag>
        <tag>北京54</tag>
        <tag>西安80</tag>
        <tag>高斯-克吕格投影</tag>
        <tag>UTM</tag>
        <tag>墨卡托投影</tag>
        <tag>时区</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[基于Arduino实现Android控制的电灯]]></title>
    <url>%2F2012%2F05%2F01%2Farduino-light-old%2F</url>
    <content type="text"><![CDATA[主要介绍使用Arduino做出一个可以通过Android手机控制开关的电灯。试想，当你晚上睡在床上，打开手机，关闭书房或者走廊的电灯，是不是一件很cool的事情。 一、所需部件介绍 Arduino UNO板这当然是必须的。不过这里要特别说明一下，我使用是的DF-Bluetooth V3的蓝牙模块，而部分Arduino UNO板由于串口限流电阻设计存在问题，会导致蓝牙模块只能发送数据而不能接收数据，这实在是一个很大的问题。我因为这个原因，又重新购买了一块新的Arduino UNO板。所以，在购买时请注意咨询卖家，确认是否已经改造过串口电阻，支持DF-Bluetooth V3模块。在进行制作前，也请先验证你的UNO板是否能通过蓝牙模块正常接收数据。 蓝牙模块（BluetoothV3）及传感器扩展板我使用的是DF-Bluetooth V3蓝牙模块及Arduino Xbee传感器扩展板V5，这两者是配套的。当然没有扩展板也没有关系，直接连线通过SoftSerial方式会更好调试。有了扩展板，在使用的时候会更清爽，一根连线都不用了。 继电器由于要控制220v的电灯，所以我们需要一个继电器模块，用小电流来控制大电流设备。我使用的是Arduino兼容的JQC-3FF继电器模块，能承受277V/10A的交流设备，这对我们制作电灯来说足够用了，而且做工还挺精致的。 Android手机当然，肯定还有android手机。必须android2.0以上系统的android手机，推荐2.3及以上系统，必须要有蓝牙喲（废话）。 二、电路连接 继电器与电灯的连接继电器有四个接线柱：NO、NC、N/A、COM。在接通控制电源后，通过控制信号，可以控制NO/NC与COM端口的闭合。我制作了一个简单的灯，将接线的火线断开，分别接在NO口与COM口。继电器的模块引脚有三个，分别是：1脚–控制端，2脚–电源（VCC），3脚–地（GND），使用数据线直接与Arduino的数字信号端口连接（扩展板有专门的插口，很方便。），我们采用7数字引脚。接好的继电器如图所示。 蓝牙模块由于是配套的扩展板，直接插上就是了。 三、Arduino程序要实现的功能其实很简单：设备通过蓝牙接收到到数据进行判断，控制继电器的开合。代码如下： 12345678910111213141516171819int LIGHT_PIN = 7; //设置继电器的控制数字引脚char bt_command;void setup()&#123; Serial.begin(9600); //蓝牙的波特率，默认一般是9600根据自己的蓝牙设备设置而定 pinMode(LIGHT_PIN,OUTPUT); &#125;void loop()&#123; bt_command = Serial.read(); //从蓝牙上读取数据 if(bt_command == &apos;1&apos;)&#123; //如果为字符1，闭合继电器，灯亮digitalWrite(LIGHT_PIN,HIGH); &#125;else if(bt_command == &apos;0&apos;)&#123; //如果为字符0，断开继电器，灯灭digitalWrite(LIGHT_PIN,LOW); &#125; delay(2000); //做一个保护，避免点击过快，损坏灯&#125; 代码很简单，相信大家理解没有问题。 四、Android代码这块相信是大家认为比较麻烦的，的确也是最麻烦的地方。不多说了，大家自己看源码。之前是用自己蓝牙的mac地址做寻址，方便。为了方便大家用，增加了设备扫描功能，这样如果不想做Android程序的，可以直接安装apk就能用。我在我的里程碑（用的MIUI）和i9100上都试过了，没问题。Enjoy it！ 代码在github上：https://github.com/kindlymouse/Arduino 五、效果演示 http://v.youku.com/v_show/id_XMzg5NDA1ODI4.html]]></content>
      <categories>
        <category>智能硬件</category>
      </categories>
      <tags>
        <tag>Arduino</tag>
        <tag>智能家居</tag>
      </tags>
  </entry>
</search>